# 시계열 데이터란?

- 일정한 시간 동안 수집된 일련의 순차적으로 정해진 dataset의 집합
- 시간에 관해 순서가 매겨져 있음. 연속한 관측치는 서로 상관관계를 가지고 있음
- 시계열 분석 목적은 시계열이 갖고 있는 법칙성을 발견해 이를 모형화하고, 또 추정된 모형을 토아혀 미래의 값을 예측

# 시계열의 종류
- 네 가지의 변동 요인
- 자료들의 특성 단순화를 가정
1. 추세변동
2. 계절변동
3. 순환변동
4. 불규칙 변동

## 1. 추세변동
- 시계열의 장기간에 걸친 점진적이고 지속적인 변화 상태를 나타냄
- 시간의 흐름에 따른 시계열자료들의 상승경향이나 하강경향의 상태를 의미

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/4d2353cc-ed20-4313-bdcf-0a31e4af2199)

## 2. 계절변동

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/35d91059-6ff5-4c00-8f4e-b5dbefd911a3)

- 관측된 시계열 자료들을 일 년 단위 혹은 더 짧은 기간의 주기로 기록했을 때, 기후 등과 같은 자연의 조건, 사회적 관습, 혹은 제도 등의 영향을 받아서 계절적인 차이를 나타내는 것
- 주기적인 pattern을 갖고 반복적으로 나타남
- 분기별, 월별 자료

## 3. 순환변동

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/8113bd0e-5540-481c-8779-a34e7714d92c)

- 경기변동
- 수 년간의 간격을 두고 상승과 하락이 주기적으로 나타나는 변동
- 기후조건, 사회적 관습 등과 같은 계절변동으로 설명되지 않는 장기적인 주기 변동
- 계절변동으로 설명되지 않는 장기적인 변동

## 4. 불규칙변동

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/7c648de2-307d-4b27-9e86-9eee9125326d)

- 사전적으로 예상할 수 없는 특수한 사건에 의해 야기 되는 변동(지진, 전쟁, 홍수, 파업 등)
- 명확히 설명될 수 없는 요인에 의해 발생되는 우연 변동

## 기본적인 속성
- 계절성(Seasonal) : 주기적으로 반복되는 pattern
- 주기성(Cycle) : 주기가 고정적이지 않는 경우
- 추세(Trend) : 장기적으로 상승하거나 하락하는 pattern
- 불규칙요소(Random, residual) : 예측 불가능한 임의의 변동성. 설명될 수 없는 요인이나 돌발적인 요인에 의해 일어난 변화.
- 일반적으로 계절성, 주기성 그리고 추세를 제외한 나머지를 불규칙 요소라 정의
- 시계열 분해(decomposition) : 위와 같은 속성들을 분리해내는 과정

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/0910a201-443d-452d-8b9d-4778b569d250)

# 시계열 전처리
- 정상성(Stationary) : 시계열이 시간에 상관없이 일정한 성질을 띄는 경우
- 정상성을 가지는 시계열은 주기성이나 추세가 보이지 않는 시계열
- 임의의 시점 t에 대한 기댓값, 분산 등의 성질이 어느 시점에서 관측하더라도 변하지 않는 것
- 시계열 데이터를 전처리한다는 것은 비정상 시계열(추세, 계절성, 분산변동이 있는 시계열)을 정상 시계열로 만들어주기 위한 과정
- 추세를 제거(Detrending), 계절성 제거(deseasoning) 또는 분산을 일정하게 만들기
- 추세와 계절성을 제거한 나머지가 정상성을 띄도록 하는 것이 전처리의 주된 목적
- 추세와 계절성을 제거하기 위한 방법
1. 회귀분석(Regression approach)
2. 평활법(Smoothing)
3. 차분(Differencing)


## 차분
- 이어진 data들의 차이를 구하는 것
- 한 번의 차이를 구하는 것을 1차 차분, 1차 차분값을 다시 차분하는 것을 2차 차분이라고 함
- Data 길이가 충분한 경우에는 여러 번 차분할 수 있지만, 2차 이상의 차분을 할 경우 data 소실이 커져서 설명력이 떨어짐
- 일반적으로 1차 차분만으로도 정상적인 시계열이 만들어지는 경우가 대부분
- 1차 차분 : $\Delta y_t = y_t - y_{t-1}$. 추세를 제거
- 계절성 차분 :  $\Delta y_t = y_t - y_{t-m}$. m : 주기의 길이. 계절성 제거
- 대부분 비정상적 시계열 갑이 누적되는 누적 과정(integrated process)이기 때문에 누적된 값을 빼줌으로써 정상적 시계열을 얻어낼 수 있음

## 역차분(Inverse difference)
- Data를 해석하기 위해서는 전처리 과정을 거친 data를 역으로 계산해주는 과정 필요. 원래의 단위로 맞추어 줌
- Decoding(복호화)
- $\Delta y_t = y_t + y_{t-1}$
-  t 시점까지의 누적변화량

## 평활법
- 과거의 data를 이용해 현재나 미래의 값을 추측하는 모형을 상태-공간 모형(state-space model)이라 함
- 추측하고자 하는 값에 따라 다음과 같은 세 가지 작업으로 분류
- $Y_j = (y_1, y_2, \cdots, y_j)$ -> 상태 공간 모형 -> $X_t$ 추정
- t 시점이 j 시점 보다 미래 시점(j < t) : 예측(Prediction, Forcasting)
- t 시점이 j 시점과 같은 현재 시점(j = t) : Filtering
- t 시점이 j 시점보다 과거 시점(t < j) : 평활화
- 평활화는 현재까지 수집한 관측치를 활용하여 현재까지의 상태변수의 history $(x_1 ~ x_t)$ 전체를 재추정
- Missing data를 채우는 경우나 금융 분야의 factor model의 계수를 추정하는 경우에 사용
- Filtering과 평활화는 정의상으로는 구분되지만, 평활화 과정으로 filtering 가능. 일반적으로 평활화 개념 안에 filtering 포함
- 목적 : 시계열 자료의 무작위성(변동성, 분산)을 줄여줌
- 다만, 변동성을 줄임으로 정보 손실이 일어날 수 있음
- 대표적인 5가지 평활법
1. 이동평균 평활법(Moving Average Smoothing)
2. 지수 평활법(Exponential Smoothing)
3. 회귀모형 평활법(OLS Smoothing)
4. Holt-Winters Smoothing
5. Kernel Smoothing

### 이동평균 평활법

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/22f363c0-cc6f-403c-a59c-2d495449bf9b)
- 과거로부터 현재까지의 시계열 자료를 대상으로 일정 기간별 이동 평균을 계산하고, 이들의 추세를 통해 다음 기간을 예측하는 방법

### 지수 평활법

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/44a3eb9d-96a9-4137-9834-b00cab4c0210)

- 모든 시계열 자료를 사용하여 평균을 구하고, 시간의 흐름에 따라서 최근 시계열에 더 많은 가중치를 부여하여 미래의 값을 예측


# EDA
- 시계열 자료는 우연변동, 추세변동, 계절변동, 주시변동 등 다양한 변동들이 중첩되어 있음. 그래서 추세와 주기를 잘 파악해야 함

## 요소 분해
- 시계열 자료를 추세변동, 주기변동, 우연변동으로 구분하여 각 요소로 분해하는 과정
- 중첩된 변동 요인들을 분해함으로써 추세와 주기를 제거하여 남은 잔차 시계열을 정상시계열로 만들기 위함
- 잔차 시계열이 정상 시계열이 아닐 경우에는 정밀한 추가 분석 필요
- 분해 방법에 따라 가법(addictive) 모형과 승법(multiplicative) 모형으로 나뉨
- 시계열 : $y_t$, 주기 변동 : $TC_t$, 계절변동 : $S_t$, 우연변동 : $R_t$
### 가법 모형(덧셈 분해, addictive decomposition)
- $y_t = S_t + TC_t + R_T$
- 선형적으로 구성된 방법. 추세와 계절성이 서로 독립이라 가정

### 승법 모형(곱셈 분해, multiplicative decomposition)
- $y_t = S_t \times TC_t \times R_t$
- 비선형적. 추세에 따라서 계절이 변화
- 승법 모형에서 log transform 시, 곱하기 형태가 더하기 형태로 변함(가법 모형의 식으로 변환 가능)
- 어떠한 경우에도 0이 존재하면 안 됨

![image](https://github.com/as9786/ML-DLPratice/assets/80622859/18602258-0ca4-4a39-9f14-62e60e8fb36c)

- 왼쪽처럼 시간이 지남에 따라 변동폭이 일정한 경우에는 가법, 오른쪽처럼 시간이 지남에 따라 변동폭이 증가하는 경우에는 승법이 적합
- 




